FROM registry.access.redhat.com/ubi9/ubi-minimal:9.7-1764578379

LABEL name="turnpike-nginx-prometheus" \
      summary="Red Hat Insights Turnpike Nginx Prometheus Exporter" \
      description="Prometheus metrics exporter for Turnpike Nginx proxy. Exposes Nginx metrics for monitoring and observability." \
      io.k8s.description="Prometheus metrics exporter for Turnpike Nginx proxy. Exposes Nginx metrics for monitoring and observability." \
      io.k8s.display-name="Red Hat Insights Turnpike Nginx Prometheus Exporter" \
      io.openshift.tags="insights,turnpike,nginx,prometheus,metrics,monitoring" \
      com.redhat.component="turnpike-nginx-prometheus" \
      version="1.0" \
      release="1" \
      vendor="Red Hat, Inc." \
      url="https://github.com/RedHatInsights/turnpike" \
      distribution-scope="private" \
      maintainer="platform-accessmanagement@redhat.com"

USER root

ENV SCRAPE_URI=http://localhost:8080/stub_status

RUN microdnf install -y tar git-core make go && \
    microdnf clean all

RUN git clone --branch v1.4.2 https://github.com/nginxinc/nginx-prometheus-exporter && \
    cd nginx-prometheus-exporter && \
    make && \
    chmod +x ./nginx-prometheus-exporter

WORKDIR /nginx-prometheus-exporter

CMD ./nginx-prometheus-exporter --nginx.scrape-uri $SCRAPE_URI
